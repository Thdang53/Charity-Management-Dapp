{"ast":null,"code":"import _objectSpread from \"C:/Users/DMC/OneDrive/Documents/SUIMOVE/charity-dapp/charity-dapp/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _objectWithoutProperties from \"C:/Users/DMC/OneDrive/Documents/SUIMOVE/charity-dapp/charity-dapp/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";\nconst _excluded = [\"address\", \"cursor\", \"limit\", \"network\", \"contract\", \"client\", \"loadClaimedAssets\"];\nimport { getFullnodeUrl, SuiClient } from \"@mysten/sui/client\";\nimport { normalizeSuiAddress } from \"@mysten/sui/utils\";\nimport { ZkSendLink } from \"./claim.js\";\nimport { getContractIds } from \"./zk-bag.js\";\nasync function getSentTransactionsWithLinks(_ref) {\n  let {\n      address,\n      cursor,\n      limit = 10,\n      network = \"mainnet\",\n      contract = getContractIds(network),\n      client = new SuiClient({\n        url: getFullnodeUrl(network)\n      }),\n      loadClaimedAssets = false\n    } = _ref,\n    linkOptions = _objectWithoutProperties(_ref, _excluded);\n  const packageId = normalizeSuiAddress(contract.packageId);\n  const page = await client.queryTransactionBlocks({\n    filter: {\n      FromAddress: address\n    },\n    order: \"descending\",\n    cursor,\n    limit,\n    options: {\n      showInput: true,\n      showObjectChanges: true,\n      showBalanceChanges: true\n    }\n  });\n  const data = await Promise.all(page.data.map(async res => {\n    var _res$transaction;\n    const transaction = (_res$transaction = res.transaction) === null || _res$transaction === void 0 ? void 0 : _res$transaction.data.transaction;\n    if ((transaction === null || transaction === void 0 ? void 0 : transaction.kind) !== \"ProgrammableTransaction\") {\n      throw new Error(\"Invalid transaction\");\n    }\n    const newLinks = await Promise.all(transaction.transactions.filter(tx => \"MoveCall\" in tx ? tx.MoveCall.package === packageId && tx.MoveCall.module === \"zk_bag\" && tx.MoveCall.function === \"new\" : false).map(async tx => {\n      var _tx$MoveCall$argument;\n      if (!(\"MoveCall\" in tx)) {\n        throw new Error(\"Expected MoveCall\");\n      }\n      const addressArg = (_tx$MoveCall$argument = tx.MoveCall.arguments) === null || _tx$MoveCall$argument === void 0 ? void 0 : _tx$MoveCall$argument[1];\n      if (!addressArg || typeof addressArg !== \"object\" || !(\"Input\" in addressArg)) {\n        throw new Error(\"Invalid address argument\");\n      }\n      const input = transaction.inputs[addressArg.Input];\n      if (input.type !== \"pure\") {\n        throw new Error(\"Expected Address input to be a Pure value\");\n      }\n      const address2 = normalizeSuiAddress(input.value);\n      const link = new ZkSendLink(_objectSpread({\n        network,\n        address: address2,\n        contract,\n        isContractLink: true,\n        client\n      }, linkOptions));\n      await link.loadAssets({\n        transaction: res,\n        loadClaimedAssets\n      });\n      return link;\n    }));\n    const regeneratedLinks = await Promise.all(transaction.transactions.filter(tx => \"MoveCall\" in tx ? tx.MoveCall.package === packageId && tx.MoveCall.module === \"zk_bag\" && tx.MoveCall.function === \"update_receiver\" : false).map(async tx => {\n      var _tx$MoveCall$argument2;\n      if (!(\"MoveCall\" in tx)) {\n        throw new Error(\"Expected MoveCall\");\n      }\n      const addressArg = (_tx$MoveCall$argument2 = tx.MoveCall.arguments) === null || _tx$MoveCall$argument2 === void 0 ? void 0 : _tx$MoveCall$argument2[2];\n      if (!addressArg || typeof addressArg !== \"object\" || !(\"Input\" in addressArg)) {\n        throw new Error(\"Invalid address argument\");\n      }\n      const input = transaction.inputs[addressArg.Input];\n      if (input.type !== \"pure\") {\n        throw new Error(\"Expected Address input to be a Pure value\");\n      }\n      const address2 = normalizeSuiAddress(input.value);\n      const link = new ZkSendLink(_objectSpread({\n        network,\n        address: address2,\n        contract,\n        isContractLink: true\n      }, linkOptions));\n      await link.loadAssets({\n        loadClaimedAssets\n      });\n      return link;\n    }));\n    return {\n      transaction: res,\n      links: [...newLinks, ...regeneratedLinks]\n    };\n  }));\n  return {\n    data,\n    nextCursor: page.nextCursor,\n    hasNextPage: page.hasNextPage\n  };\n}\nexport { getSentTransactionsWithLinks };\n//# sourceMappingURL=get-sent-transactions.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}