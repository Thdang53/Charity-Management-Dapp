{"ast":null,"code":"import{Transaction}from'@mysten/sui/transactions';import{PACKAGE_ID,MODULE_NAME,REGISTRY_ID,mistToSui}from'../config/constants';/**\r\n * Build transaction để tạo campaign mới\r\n */export function buildCreateCampaignTx(params){const tx=new Transaction();const deadlineMs=Date.now()+params.durationDays*24*60*60*1000;const goalInMist=Math.floor(params.goal*1000000000);tx.moveCall({target:\"\".concat(PACKAGE_ID,\"::\").concat(MODULE_NAME,\"::create_campaign\"),arguments:[tx.object(REGISTRY_ID),// registry\ntx.pure.string(params.title),tx.pure.string(params.description),tx.pure.u64(goalInMist),tx.pure.u64(deadlineMs),tx.pure.address(params.beneficiary)]});return tx;}/**\r\n * Build transaction để donate vào campaign\r\n */export function buildDonateTx(campaignId,amountSui){const tx=new Transaction();const amountInMist=Math.floor(amountSui*1000000000);// Split coins từ gas\nconst[coin]=tx.splitCoins(tx.gas,[tx.pure.u64(amountInMist)]);tx.moveCall({target:\"\".concat(PACKAGE_ID,\"::\").concat(MODULE_NAME,\"::donate\"),arguments:[tx.object(campaignId),coin]});return tx;}/**\r\n * Build transaction để withdraw funds\r\n */export function buildWithdrawTx(campaignId){const tx=new Transaction();tx.moveCall({target:\"\".concat(PACKAGE_ID,\"::\").concat(MODULE_NAME,\"::withdraw_funds\"),arguments:[tx.object(campaignId)]});return tx;}/**\r\n * Query tất cả campaigns từ on-chain\r\n */export async function fetchAllCampaigns(client){try{// Query tất cả Campaign objects\nconst response=await client.getOwnedObjects({filter:{StructType:\"\".concat(PACKAGE_ID,\"::\").concat(MODULE_NAME,\"::Campaign\")},options:{showContent:true,showType:true}});const campaigns=[];for(const item of response.data){var _item$data;if((_item$data=item.data)!==null&&_item$data!==void 0&&_item$data.content&&'fields'in item.data.content){const fields=item.data.content.fields;campaigns.push({id:item.data.objectId,title:bytesToString(fields.title),description:bytesToString(fields.description),creator:fields.creator,goal:mistToSui(parseInt(fields.goal)),raised:mistToSui(parseInt(fields.raised||'0')),deadline:parseInt(fields.deadline),beneficiary:fields.beneficiary,createdAt:parseInt(fields.created_at)});}}// Sort by created date (newest first)\nreturn campaigns.sort((a,b)=>b.createdAt-a.createdAt);}catch(error){console.error('Error fetching campaigns:',error);return[];}}/**\r\n * Query 1 campaign cụ thể\r\n */export async function fetchCampaign(client,campaignId){try{var _response$data;const response=await client.getObject({id:campaignId,options:{showContent:true}});if(!((_response$data=response.data)!==null&&_response$data!==void 0&&_response$data.content)||!('fields'in response.data.content)){return null;}const fields=response.data.content.fields;return{id:campaignId,title:bytesToString(fields.title),description:bytesToString(fields.description),creator:fields.creator,goal:mistToSui(parseInt(fields.goal)),raised:mistToSui(parseInt(fields.raised||'0')),deadline:parseInt(fields.deadline),beneficiary:fields.beneficiary,createdAt:parseInt(fields.created_at)};}catch(error){console.error('Error fetching campaign:',error);return null;}}/**\r\n * Helper: Convert bytes array to string\r\n */function bytesToString(bytes){if(typeof bytes==='string')return bytes;return new TextDecoder().decode(new Uint8Array(bytes));}/**\r\n * Helper: Check if campaign is active\r\n */export function isCampaignActive(campaign){return Date.now()<campaign.deadline;}/**\r\n * Helper: Get campaign progress percentage\r\n */export function getCampaignProgress(campaign){if(campaign.goal===0)return 0;return Math.min(campaign.raised/campaign.goal*100,100);}/**\r\n * Helper: Format time remaining\r\n */export function getTimeRemaining(deadline){const now=Date.now();const diff=deadline-now;if(diff<=0)return'Expired';const days=Math.floor(diff/(1000*60*60*24));const hours=Math.floor(diff%(1000*60*60*24)/(1000*60*60));if(days>0)return\"\".concat(days,\" day\").concat(days>1?'s':'',\" left\");if(hours>0)return\"\".concat(hours,\" hour\").concat(hours>1?'s':'',\" left\");return'Less than 1 hour';}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}